RewriteEngine On

# Enable proxy for WebSocket (must come BEFORE regular API proxy)
RewriteCond %{HTTP:Upgrade} =websocket [NC]
RewriteCond %{HTTP:Connection} =Upgrade [NC]
RewriteRule ^api/broker/ws(.*)$ ws://185.136.159.142:8080/api/broker/ws$1 [P,L]

# Enable proxy for regular API requests
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^api/(.*)$ http://185.136.159.142:8080/api/$1 [P,L]

# Fallback to index.html for React Router (SPA)
# Use per-directory relative path to avoid breaking when deployed in a subfolder like /v2
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^ index.html [L]
